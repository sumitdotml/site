---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import DateMeta from "../components/DateMeta.astro";
import ViewCounter from "../components/ViewCounter.astro";
import { SITE_TITLE } from "../consts";
import "../styles/layout.css";
import type { ImageMetadata } from "astro";

interface Props {
	title: string;
	description?: string;
	breadcrumbTitle?: string;
	pubDate?: Date;
	updatedDate?: Date;
	date?: Date;
	dateLabel?: string;
	dateLabels?: {
		published?: string;
		updated?: string;
		page?: string;
	};
	image?: ImageMetadata;
	slug?: string; // for view tracking
	workerUrl?: string; // optional: custom worker URL
}

const {
	title,
	description = "",
	breadcrumbTitle,
	pubDate,
	updatedDate,
	date,
	dateLabel,
	dateLabels,
	image,
	slug,
	workerUrl,
} = Astro.props;

const labels = {
	published: dateLabels?.published ?? "Published:",
	updated: dateLabels?.updated ?? "Updated:",
	page: dateLabels?.page ?? dateLabel ?? "Last updated:",
};

const dateEntries = [
	pubDate && { label: labels.published, value: pubDate },
	updatedDate && { label: labels.updated, value: updatedDate },
	!pubDate && date && { label: labels.page, value: date },
].filter(Boolean) as Array<{ label?: string; value: Date }>;

const pageTitle = pubDate ? title : `${title} | ${SITE_TITLE}`;
---

<html lang="en">
	<head>
		<BaseHead title={pageTitle} description={description} image={image} />
	</head>

	<body>
		<Header breadcrumbTitle={breadcrumbTitle} />
		<main>
			<article>
				<div class="post-header">
					<h1 class="post-title">{title}</h1>
					{
						dateEntries.length > 0 && (
							<div class="post-dates">
								{dateEntries.map(({ label, value }, index) => (
									<DateMeta date={value} label={label} as="div" key={index} />
								))}
								{slug && <ViewCounter slug={slug} workerUrl={workerUrl} />}
							</div>
						)
					}
				</div>
				<slot />
			</article>
		</main>
		<Footer />
	</body>
</html>
