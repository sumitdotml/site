---
import { HOME_ICON, findNavLabel } from "../data/navigation";

interface Props {
	customTitle?: string;
}

const { customTitle } = Astro.props;
const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const pathSegments = pathname.split("/").filter((segment) => segment !== "");

const breadcrumbs = [
	{
		label: HOME_ICON,
		href: "/",
		isActive: pathname === "" || pathname === "/",
		isHome: true,
	},
];

let currentPath = "";
pathSegments.forEach((segment, index) => {
	currentPath += `/${segment}`;
	const isLast = index === pathSegments.length - 1;
	const navLabel = findNavLabel(segment);
	const label =
		isLast && customTitle
			? customTitle
			: (navLabel ?? segment.charAt(0).toUpperCase() + segment.slice(1));
	breadcrumbs.push({
		label,
		href: currentPath,
		isActive: isLast,
		isHome: false,
	});
});
---

<nav class="breadcrumbs" aria-label="Breadcrumb">
	{
		breadcrumbs.map((crumb, index) => (
			<>
				{index > 0 && <span class="separator">/</span>}
				<a
					href={crumb.href}
					class:list={[
						"breadcrumb-link",
						{ active: crumb.isActive, home: crumb.isHome },
					]}
					aria-current={crumb.isActive ? "page" : undefined}
				>
					{crumb.label}
				</a>
			</>
		))
	}
</nav>

<style>
	.breadcrumbs {
		display: flex;
		align-items: baseline;
		gap: 0.5em;
		font-size: 0.9em;
		flex-wrap: wrap;
	}

	.separator {
		color: var(--text-color);
		opacity: 0.4;
		font-weight: var(--font-weight-light);
	}

	.breadcrumb-link {
		text-decoration: none;
		color: var(--text-color);
		opacity: 0.5;
		font-weight: var(--font-weight-regular);
		transition:
			opacity 0.2s ease,
			color 0.2s ease;
	}

	.breadcrumb-link:hover {
		opacity: 0.8;
		color: var(--accent-purple);
	}

	.breadcrumb-link.active {
		opacity: 1;
		color: var(--text-color);
		font-weight: var(--font-weight-medium);
		pointer-events: none;
	}

	.breadcrumb-link.home {
		font-size: 1.3em;
		line-height: 1;
		opacity: 1;
		display: inline-flex;
		align-items: center;
	}

	.breadcrumb-link.home:hover {
		opacity: 1;
	}

	@media (max-width: 360px) {
		.breadcrumbs {
			font-size: 0.85em;
			gap: 0.4em;
		}
	}
</style>
